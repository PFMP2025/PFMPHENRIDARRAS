<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test d‚Äôorientation ‚Äî Bac Pro</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f8fb;
      --surface:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --primary:#0b4ea2;   /* bleu CIEL */
      --melec:#1f8b4c;      /* vert MELEC */
      --chaud:#7b3fb3;      /* violet Chaudronnerie */
      --ring: rgba(11,78,162,.25);
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.6;
    }

    /* ===== Nav / header ===== */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(180%) blur(8px);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      border-bottom:1px solid #e5e7eb;
    }
    .top-inner{max-width:1100px; margin:0 auto; padding:12px 18px; display:flex; align-items:center; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .logo{width:34px; height:34px; border-radius:10px; display:grid; place-items:center; color:#fff;
      background:linear-gradient(135deg, var(--primary), #1d4ed8); box-shadow:0 6px 16px rgba(29,78,216,.35);
      font-size:18px}
    .brand span{letter-spacing:.2px}

    .retour{
      margin-left:auto;
      appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:700;
      background:#111827; color:#fff; cursor:pointer; display:inline-flex; align-items:center; gap:8px;
      box-shadow:var(--shadow); text-decoration:none;
    }
    .retour:focus-visible{outline:3px solid var(--ring)}

    /* ===== Page hero ===== */
    .hero{max-width:1100px; margin:18px auto 0; padding:0 18px 8px}
    .hero h1{margin:.2rem 0 .2rem; font-size:clamp(20px, 3.2vw, 34px)}
    .hero p{margin:0; color:var(--muted)}

    /* ===== Shell ===== */
    .container{max-width:1100px; margin:0 auto; padding:0 18px 70px}
    .form-card{
      background:var(--surface); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:18px;
    }

    /* ===== Progress ===== */
    .progress-wrap{position:sticky; top:64px; z-index:40; margin:14px 0}
    .progress{
      height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden;
      box-shadow:inset 0 1px 2px rgba(0,0,0,.05);
    }
    .progress > span{
      display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--primary), #1d4ed8);
      transition:width .25s ease; border-radius:inherit;
    }
    .progress-meta{display:flex; justify-content:space-between; font-size:12px; color:var(--muted); margin-top:6px}

    /* ===== Question block ===== */
    .question{margin:16px 0; padding:16px; border:1px solid #e5e7eb; border-radius:14px; background:#f9fafb}
    .question h2{margin:0 0 10px; font-size:16px; color:var(--primary)}
    .options{display:flex; flex-direction:column; gap:8px}
    label.option{
      background:#fff; border:1px solid #e5e7eb; padding:12px; border-radius:12px;
      display:flex; align-items:center; gap:10px; cursor:pointer; color:#374151; transition:transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    label.option:hover{transform:translateY(-1px)}
    label.option input{accent-color:var(--primary)}
    input[type="radio"]{margin:0 6px 0 0}
    /* selected state */
    .option.selected{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(59,130,246,.15)}

    /* ===== Submit ===== */
    .submit{
      display:flex; justify-content:center; margin:24px 0 8px;
    }
    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 18px; font-weight:700; cursor:pointer;
      box-shadow:var(--shadow); background:linear-gradient(135deg, #2563eb, #1d4ed8); color:#fff;
    }
    .btn:disabled{filter:grayscale(1) brightness(.9); cursor:not-allowed; opacity:.7}

    /* ===== Result ===== */
    #resultat{
      display:none; margin:22px auto 0; max-width:820px; background:#e0f2fe; border:1px solid #bfdbfe;
      color:#0c4a6e; border-radius:14px; padding:18px; box-shadow:0 2px 10px rgba(0,0,0,.05);
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin:.5rem 0}
    .chip{font-size:12px; font-weight:700; padding:6px 10px; border-radius:999px; background:#eef2ff; color:var(--primary)}
    .chip[data-fil="MELEC"]{background:#ebf7ef; color:var(--melec)}
    .chip[data-fil="Chaudronnerie"]{background:#f4ebff; color:var(--chaud)}

    canvas{display:block; margin:18px auto; max-width:520px}

    /* ===== Footer space ===== */
    .spacer{height:50px}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="topbar" role="navigation">
    <div class="top-inner">
      <div class="brand" aria-label="Accueil">
        <div class="logo">HD</div><span>Test d‚Äôorientation ‚Äî Bac Pro</span>
      </div>
      <!-- Retour direct √† l'accueil -->
      <a class="retour" href="index.html" title="Retour √† l‚Äôaccueil">‚Üê Retour √† l‚Äôaccueil</a>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <h1>Quelle fili√®re & quel m√©tier te correspondent ?</h1>
    <p>R√©ponds aux questions ci‚Äëdessous. Tu peux revenir en arri√®re √† tout moment.</p>
  </section>

  <main class="container">
    <div class="progress-wrap" aria-hidden="false">
      <div class="progress" aria-label="Progression">
        <span id="progressBar"></span>
      </div>
      <div class="progress-meta">
        <span id="progressTxt">0 / 40 questions r√©pondues</span>
        <span id="remainingTxt">Il reste 40 questions</span>
      </div>
    </div>

    <form id="qcmForm" class="form-card" novalidate></form>

    <div id="resultat"></div>
    <canvas id="graphiqueFiliere" style="display:none"></canvas>
    <div class="spacer"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ----- M√©tier / Fili√®re dictionnaire -----
    const metiers = {
      ciel_devweb: { nom: "D√©veloppeur web", filiere: "CIEL" },
      ciel_embarque: { nom: "D√©veloppeur embarqu√©", filiere: "CIEL" },
      ciel_cyber: { nom: "Technicien cybers√©curit√©", filiere: "CIEL" },
      ciel_electronique: { nom: "Technicien √©lectronique", filiere: "CIEL" },
      melec_electricien: { nom: "√âlectricien du b√¢timent", filiere: "MELEC" },
      melec_maintenance: { nom: "Technicien de maintenance", filiere: "MELEC" },
      chaudron_soudeur: { nom: "Soudeur", filiere: "Chaudronnerie" },
      chaudron_assembleur: { nom: "Assembleur en structures m√©talliques", filiere: "Chaudronnerie" }
    };

    // ----- Questions (reprend le contenu actuel) -----
    const questions = [];
  </script>
  <!-- Inject original questions from your previous file via inline JSON to keep logic identical -->
  <script>
  /* QUESTIONS START (copied 1:1 for fidelity) */
  const rawQuestions = [
    { q: "1. Quand tu travailles sur un projet, tu pr√©f√®res :", options: [ { t: "Avoir une certaine autonomie pour organiser ton travail √† ta fa√ßon", m: ["ciel_devweb", "ciel_cyber", "chaudron_soudeur"] }, { t: "Suivre une m√©thode pr√©cise et bien d√©finie", m: ["melec_electricien", "chaudron_soudeur", "ciel_cyber"] }, { t: "Travailler avec d‚Äôautres pour avancer ensemble", m: ["melec_electricien", "chaudron_assembleur"] } ] },
    { q: "2. Tu es le plus satisfait quand tu :", options: [ { t: "R√©sous un probl√®me complexe en trouvant une solution logique", m: ["ciel_cyber", "ciel_devweb", "melec_maintenance"] }, { t: "Vois le r√©sultat concret de ce que tu as fabriqu√© ou install√©", m: ["melec_electricien", "chaudron_soudeur"] }, { t: "Am√©liores ou ajustes quelque chose de tes mains", m: ["chaudron_assembleur", "melec_maintenance"] } ] },
    { q: "3. Quand tu d√©couvres un nouvel outil ou syst√®me, tu as tendance √† :", options: [ { t: "Chercher comment il fonctionne, quitte √† l‚Äôouvrir ou tester", m: ["chaudron_soudeur", "ciel_embarque", "melec_electricien"] }, { t: "Lire la documentation ou les r√®gles de s√©curit√© avant", m: ["ciel_cyber", "melec_maintenance"] }, { t: "Observer d‚Äôabord les autres avant d‚Äôessayer toi-m√™me", m: ["chaudron_assembleur", "melec_electricien"] } ] },
    { q: "4. Ce qui te motive le plus :", options: [ { t: "Cr√©er des outils ou programmes utiles", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Prot√©ger ou v√©rifier des syst√®mes sensibles", m: ["ciel_cyber", "melec_maintenance"] }, { t: "Assembler ou installer avec pr√©cision", m: ["chaudron_assembleur", "melec_electricien"] } ] },
    { q: "5. Ton environnement id√©al serait :", options: [ { t: "Un endroit calme avec ordinateurs et logiciels", m: ["ciel_devweb", "ciel_cyber"] }, { t: "Un atelier ou un chantier avec des outils techniques", m: ["melec_electricien", "chaudron_soudeur"] }, { t: "Un espace industriel avec des plans et des pi√®ces √† monter", m: ["chaudron_assembleur", "melec_maintenance"] } ] },
    { q: "6. Face √† une difficult√© technique, tu pr√©f√®res :", options: [ { t: "Analyser calmement la situation pour trouver une cause logique", m: ["ciel_cyber", "melec_maintenance"] }, { t: "Essayer directement des solutions concr√®tes", m: ["melec_electricien", "chaudron_soudeur"] }, { t: "Poser des questions et chercher en √©quipe", m: ["chaudron_assembleur", "ciel_embarque"] } ] },
    { q: "7. Tu aimes particuli√®rement :", options: [ { t: "Programmer ou comprendre des circuits √©lectroniques", m: ["ciel_embarque", "ciel_electronique"] }, { t: "Travailler sur des c√¢bles, moteurs ou installations", m: ["melec_electricien", "melec_maintenance"] }, { t: "Manipuler des outils de d√©coupe, soudure ou assemblage", m: ["chaudron_soudeur", "chaudron_assembleur"] } ] },
    { q: "8. Tu te sens plus √† l‚Äôaise quand :", options: [ { t: "Tu peux imaginer ou cr√©er quelque chose de nouveau", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Tu respectes un plan, une norme ou une consigne", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Tu interviens en autonomie sur un syst√®me concret", m: ["melec_maintenance", "chaudron_soudeur"] } ] },
    { q: "9. Quel compliment te ferait le plus plaisir ?", options: [ { t: "Tu trouves toujours une solution originale !", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Tu travailles proprement et efficacement.", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "On peut compter sur toi, tu assures le fonctionnement des choses.", m: ["melec_maintenance", "ciel_cyber"] } ] },
    { q: "10. Si tu devais choisir un projet, ce serait :", options: [ { t: "Cr√©er un objet connect√© qui r√©agit √† l‚Äôenvironnement", m: ["ciel_embarque", "ciel_electronique"] }, { t: "Monter et c√¢bler une installation √©lectrique compl√®te", m: ["melec_electricien"] }, { t: "Assembler une structure m√©tallique selon un plan", m: ["chaudron_assembleur"] } ] },
    { q: "11. Quand un syst√®me ne fonctionne pas, tu as tendance √† :", options: [ { t: "Chercher calmement le bug ou la cause logique", m: ["ciel_cyber", "ciel_embarque", "melec_maintenance"] }, { t: "Penser √† une solution m√©canique ou physique", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Agir directement pour r√©parer ou tester", m: ["chaudron_soudeur", "melec_electricien"] } ] },
    { q: "12. Tu pr√©f√®res apprendre en :", options: [ { t: "Testant par toi-m√™me et en exp√©rimentant", m: ["ciel_devweb", "ciel_embarque", "chaudron_soudeur"] }, { t: "√âcoutant les consignes et suivant une proc√©dure", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Posant des questions et en analysant", m: ["ciel_cyber", "melec_maintenance"] } ] },
    { q: "13. Face √† un plan ou un sch√©ma :", options: [ { t: "Tu le comprends rapidement et tu sais l‚Äôappliquer", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Tu veux d‚Äôabord le modifier ou l‚Äôadapter", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Tu pr√©f√®res qu‚Äôon t‚Äôexplique chaque √©tape", m: ["chaudron_soudeur", "melec_maintenance"] } ] },
    { q: "14. Tu es du genre √† :", options: [ { t: "Imaginer comment am√©liorer un objet ou syst√®me", m: ["ciel_embarque", "ciel_devweb", "melec_maintenance"] }, { t: "Suivre √† la lettre ce qu‚Äôon t‚Äôa montr√©", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "T‚Äôadapter et bricoler avec ce que tu as sous la main", m: ["chaudron_soudeur", "ciel_electronique"] } ] },
    { q: "15. Tu es fier quand tu :", options: [ { t: "Cr√©es quelque chose de nouveau et fonctionnel", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Contribues √† un travail collectif bien fait", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "R√©pares ou ajustes quelque chose qui bloquait", m: ["melec_maintenance", "chaudron_soudeur"] } ] },
    { q: "16. Tu pr√©f√®res travailler dans un environnement :", options: [ { t: "Calme, technique, avec concentration", m: ["ciel_cyber", "ciel_electronique"] }, { t: "Dynamique, physique, avec du mouvement", m: ["melec_electricien", "chaudron_soudeur"] }, { t: "Structur√©, avec des √©tapes pr√©cises", m: ["melec_maintenance", "chaudron_assembleur"] } ] },
    { q: "17. Ce que tu trouves le plus int√©ressant, c‚Äôest :", options: [ { t: "Comprendre comment fonctionnent les syst√®mes connect√©s", m: ["ciel_embarque", "ciel_cyber"] }, { t: "Travailler avec des outils et des mat√©riaux", m: ["chaudron_soudeur", "melec_electricien"] }, { t: "Suivre une proc√©dure d‚Äôinstallation ou de d√©pannage", m: ["melec_maintenance", "chaudron_assembleur"] } ] },
    { q: "18. Tu aimes que ton travail soit :", options: [ { t: "Visible et utile pour les autres", m: ["melec_electricien", "chaudron_soudeur"] }, { t: "Structur√© et document√©", m: ["ciel_cyber", "melec_maintenance"] }, { t: "Cr√©atif ou personnalisable", m: ["ciel_devweb", "ciel_embarque"] } ] },
    { q: "19. Tu te sens plus efficace quand :", options: [ { t: "Tu travailles seul sur un poste technique", m: ["ciel_cyber", "ciel_embarque"] }, { t: "Tu fais partie d‚Äôune √©quipe de montage ou de chantier", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Tu alternes travail manuel et r√©solution de probl√®me", m: ["melec_maintenance", "chaudron_soudeur"] } ] },
    { q: "20. Si tu devais participer √† une mission, tu choisirais :", options: [ { t: "Cr√©er une application ou un syst√®me embarqu√©", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Installer et tester une installation √©lectrique", m: ["melec_electricien", "melec_maintenance"] }, { t: "Souder et monter une pi√®ce complexe en m√©tal", m: ["chaudron_soudeur", "chaudron_assembleur"] } ] },
    { q: "21. Dans tes activit√©s, tu es plus attir√© par :", options: [ { t: "Les syst√®mes ou objets qu‚Äôon peut comprendre et analyser", m: ["ciel_embarque", "ciel_cyber", "melec_maintenance"] }, { t: "Ce qui est concret, manipulable, avec des r√©sultats visibles", m: ["melec_electricien", "chaudron_soudeur"] }, { t: "Ce qu‚Äôon peut construire, monter ou assembler soi-m√™me", m: ["chaudron_assembleur", "melec_electricien"] } ] },
    { q: "22. Dans un travail d‚Äô√©quipe, tu pr√©f√®res :", options: [ { t: "Apporter des id√©es et tester des solutions", m: ["ciel_embarque", "melec_maintenance"] }, { t: "Appliquer une m√©thode pour que tout soit bien fait", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Faire des t√¢ches techniques que tu ma√Ætrises bien", m: ["chaudron_soudeur", "ciel_cyber"] } ] },
    { q: "23. Une situation id√©ale pour toi serait :", options: [ { t: "R√©soudre un bug logiciel ou √©lectronique", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Remettre en marche une installation en panne", m: ["melec_maintenance", "melec_electricien"] }, { t: "R√©aliser une pi√®ce technique conforme √† un plan", m: ["chaudron_assembleur", "chaudron_soudeur"] } ] },
    { q: "24. Tu te consid√®res comme quelqu‚Äôun de :", options: [ { t: "Curieux et logique", m: ["ciel_devweb", "ciel_cyber"] }, { t: "Pr√©cis et appliqu√©", m: ["chaudron_assembleur", "melec_electricien"] }, { t: "Autonome et d√©brouillard", m: ["chaudron_soudeur", "melec_maintenance"] } ] },
    { q: "25. Ce que tu observes en premier, c‚Äôest :", options: [ { t: "Les d√©tails techniques ou les petits √©l√©ments invisibles aux autres", m: ["ciel_electronique", "ciel_cyber"] }, { t: "La solidit√© ou le bon fonctionnement d‚Äôun objet ou syst√®me", m: ["melec_maintenance", "melec_electricien"] }, { t: "L‚Äôaspect ext√©rieur et la finition d‚Äôun travail bien fait", m: ["chaudron_soudeur", "chaudron_assembleur"] } ] },
    { q: "26. Ce que tu pr√©f√®res dans un travail technique :", options: [ { t: "Comprendre comment √ßa marche et pourquoi", m: ["ciel_embarque", "ciel_cyber"] }, { t: "Appliquer un protocole ou une m√©thode s√ªre", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Ajuster, tester, am√©liorer manuellement", m: ["melec_maintenance", "chaudron_soudeur"] } ] },
    { q: "27. Tu aimes particuli√®rement quand tu peux :", options: [ { t: "Manipuler un syst√®me intelligent ou connect√©", m: ["ciel_embarque", "ciel_electronique"] }, { t: "Contribuer √† une installation technique en √©quipe", m: ["melec_electricien", "melec_maintenance"] }, { t: "Fabriquer quelque chose √† partir d‚Äôun plan ou d‚Äôun mod√®le", m: ["chaudron_assembleur", "chaudron_soudeur"] } ] },
    { q: "28. Ce que tu appr√©cies le plus, c‚Äôest :", options: [ { t: "Cr√©er quelque chose de fonctionnel √† partir d‚Äôune id√©e", m: ["ciel_devweb", "ciel_embarque"] }, { t: "R√©parer ou faire fonctionner un syst√®me concret", m: ["melec_maintenance", "melec_electricien"] }, { t: "Assembler ou souder des pi√®ces avec pr√©cision", m: ["chaudron_assembleur", "chaudron_soudeur"] } ] },
    { q: "29. Si tu √©tais technicien, tu pr√©f√©rerais :", options: [ { t: "Concevoir et programmer des solutions", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Assurer le bon fonctionnement d‚Äôinstallations", m: ["melec_maintenance", "melec_electricien"] }, { t: "R√©aliser des pi√®ces ou des structures m√©talliques", m: ["chaudron_assembleur", "chaudron_soudeur"] } ] },
    { q: "30. Tu as plus d'affinit√© avec :", options: [ 
      { t: "Les syst√®mes √©lectroniques et informatiques", m: ["ciel_embarque", "ciel_electronique"] },
      { t: "Les installations √©lectriques et techniques", m: ["melec_maintenance", "melec_electricien"] },
      { t: "La fabrication ou le montage de pi√®ces m√©talliques", m: ["chaudron_assembleur", "chaudron_soudeur"] }
    ] },
    { q: "31. Tu pr√©f√®res une activit√© o√π tu peux :", options: [ { t: "R√©fl√©chir, tester, ajuster pour que tout fonctionne", m: ["ciel_embarque", "melec_maintenance"] }, { t: "Reproduire exactement ce qu‚Äôon t‚Äôa demand√©", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Travailler librement sur une t√¢che technique", m: ["chaudron_soudeur", "ciel_devweb"] } ] },
    { q: "32. Ce que tu fais naturellement, m√™me sans qu‚Äôon te le demande :", options: [ { t: "Chercher comment am√©liorer ce qui existe", m: ["ciel_devweb", "ciel_embarque"] }, { t: "V√©rifier que tout est bien branch√©, bien fix√©", m: ["melec_electricien", "melec_maintenance"] }, { t: "Ajuster ou corriger un d√©tail manuel ou visuel", m: ["chaudron_soudeur", "chaudron_assembleur"] } ] },
    { q: "33. Pour toi, un bon projet est :", options: [ { t: "Bien document√©, test√© et s√ªr", m: ["ciel_cyber", "melec_maintenance"] }, { t: "Construit proprement, respectant les consignes", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Cr√©atif, original, personnalis√©", m: ["ciel_devweb", "chaudron_soudeur"] } ] },
    { q: "34. En atelier, tu pr√©f√®res :", options: [ { t: "T‚Äôoccuper des branchements ou r√©glages", m: ["melec_electricien", "melec_maintenance"] }, { t: "Monter, assembler, souder des pi√®ces", m: ["chaudron_soudeur", "chaudron_assembleur"] }, { t: "Tester ou programmer des syst√®mes", m: ["ciel_embarque", "ciel_electronique"] } ] },
    { q: "35. Si tu devais faire un stage, tu pr√©f√©rerais :", options: [ { t: "Un lieu avec ordinateurs, serveurs ou objets connect√©s", m: ["ciel_devweb", "ciel_cyber", "ciel_embarque"] }, { t: "Un chantier √©lectrique ou industriel", m: ["melec_electricien", "melec_maintenance"] }, { t: "Un atelier de m√©tallurgie ou de fabrication", m: ["chaudron_soudeur", "chaudron_assembleur"] } ] },
    { q: "36. Ce que tu trouves le plus satisfaisant :", options: [ { t: "Que tout fonctionne parfaitement sans erreur", m: ["ciel_cyber", "melec_maintenance"] }, { t: "Que l‚Äôinstallation soit finie et bien pos√©e", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Que la pi√®ce soit solide et bien soud√©e", m: ["chaudron_soudeur", "ciel_electronique"] } ] },
    { q: "37. Dans ton futur m√©tier, tu aimerais surtout :", options: [ { t: "Intervenir sur des syst√®mes complexes √† faire √©voluer", m: ["melec_maintenance", "ciel_embarque"] }, { t: "Contribuer √† des installations concr√®tes et utiles", m: ["melec_electricien", "chaudron_assembleur"] }, { t: "Fabriquer ou r√©parer avec pr√©cision des √©l√©ments techniques", m: ["chaudron_soudeur", "ciel_electronique"] } ] },
    { q: "38. Tu te reconnais le plus dans :", options: [ { t: "L‚Äôenvie de comprendre ce qu‚Äôil y a derri√®re un syst√®me", m: ["ciel_embarque", "ciel_cyber"] }, { t: "Le besoin de voir, toucher, manipuler les √©l√©ments", m: ["melec_electricien", "chaudron_soudeur"] }, { t: "La pr√©cision et l‚Äôorganisation", m: ["melec_maintenance", "chaudron_assembleur"] } ] },
    { q: "39. Ton entourage dit souvent que tu es :", options: [ { t: "Astucieux, logique et d√©brouillard", m: ["ciel_devweb", "ciel_embarque"] }, { t: "Fiable, s√©rieux, organis√©", m: ["melec_maintenance", "melec_electricien"] }, { t: "Minutieux, manuel, efficace", m: ["chaudron_soudeur", "chaudron_assembleur"] } ] },
    { q: "40. Tu aimerais un jour :", options: [ { t: "Cr√©er un syst√®me intelligent qui r√©agit ou communique", m: ["ciel_embarque", "ciel_electronique"] }, { t: "Superviser une installation et assurer sa s√©curit√©", m: ["melec_maintenance", "ciel_cyber"] }, { t: "R√©aliser une pi√®ce technique de A √† Z", m: ["chaudron_assembleur", "chaudron_soudeur"] } ] }
  ];
  /* QUESTIONS END */
  </script>
  <script>
    // ---- Build form ----
    const form = document.getElementById("qcmForm");
    const progressBar = document.getElementById("progressBar");
    const progressTxt = document.getElementById("progressTxt");
    const remainingTxt = document.getElementById("remainingTxt");

    const totalQuestions = rawQuestions.length;
    const answers = new Array(totalQuestions).fill(null);

    rawQuestions.forEach((q, i) => {
      const block = document.createElement("div");
      block.className = "question";

      const title = document.createElement("h2");
      title.textContent = q.q;
      block.appendChild(title);

      const options = document.createElement("div");
      options.className = "options";

      q.options.forEach((opt) => {
        const id = `q${i}-${opt.t.slice(0,8).replace(/\W+/g,'')}-${Math.random().toString(36).slice(2,6)}`;
        const label = document.createElement("label");
        label.className = "option";
        label.setAttribute("for", id);

        const input = document.createElement("input");
        input.type = "radio"; input.id = id; input.name = "q"+i; input.value = opt.m.join(',');

        input.addEventListener("change", () => {
          // mark selected style
          [...options.querySelectorAll(".option")].forEach(el => el.classList.remove("selected"));
          label.classList.add("selected");
          answers[i] = input.value;
          updateProgress();
        });

        const text = document.createElement("span");
        text.textContent = opt.t;

        label.appendChild(input);
        label.appendChild(text);
        options.appendChild(label);
      });

      block.appendChild(options);
      form.appendChild(block);
    });

    // Submit
    const submitWrap = document.createElement("div");
    submitWrap.className = "submit";
    const submitBtn = document.createElement("button");
    submitBtn.type = "submit"; submitBtn.className = "btn";
    submitBtn.textContent = "Voir mes r√©sultats";
    submitWrap.appendChild(submitBtn);
    form.appendChild(submitWrap);

    function updateProgress(){
      const answered = answers.filter(Boolean).length;
      const pct = Math.round((answered/totalQuestions)*100);
      progressBar.style.width = pct + "%";
      progressTxt.textContent = answered + " / " + totalQuestions + " questions r√©pondues";
      remainingTxt.textContent = "Il reste " + (totalQuestions-answered) + " questions";
      submitBtn.disabled = answered === 0;
    }
    updateProgress();

    // ---- Scoring ----
    form.addEventListener("submit", function(e){
      e.preventDefault();
      // compute
      const scores = {}, filieres = {};
      for (let key in metiers) { scores[key]=0; filieres[metiers[key].filiere]=0; }

      answers.forEach(val => {
        if(!val) return;
        val.split(',').forEach(m => { scores[m]++; filieres[metiers[m].filiere]++; });
      });

      const totalMetierPoints = Object.values(scores).reduce((a,b)=>a+b,0) || 1;
      const topMetiers = Object.entries(scores)
        .map(([key,val])=>({ nom: metiers[key].nom, fil: metiers[key].filiere, score: Math.round((val/totalMetierPoints)*100) }))
        .filter(r=>r.score>0)
        .sort((a,b)=>b.score-a.score)
        .slice(0,3);

      const topFiliere = Object.entries(filieres).sort((a,b)=>b[1]-a[1])[0]?.[0] || "‚Äî";

      const res = document.getElementById("resultat");
      res.innerHTML = `
        <h2>üîé R√©sultats</h2>
        <p><strong>Fili√®re dominante : ${topFiliere}</strong></p>
        <div class="chips">
          ${topMetiers.map(r=>`<span class="chip" data-fil="${r.fil}">${r.nom} ‚Äî ${r.score}%</span>`).join("")}
        </div>
        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
          <a href="index.html" class="retour">‚Üê Revenir √† l‚Äôaccueil</a>
          <button type="button" id="restart" class="retour" style="background:linear-gradient(135deg,#2563eb,#1d4ed8)">üîÅ Recommencer</button>
        </div>
      `;
      res.style.display = "block";
      form.style.display = "none";

      // Chart
      const canvas = document.getElementById("graphiqueFiliere");
      canvas.style.display = "block";
      const ctx = canvas.getContext("2d");
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['CIEL', 'MELEC', 'Chaudronnerie'],
          datasets: [{
            label: 'R√©partition par fili√®re',
            data: [ filieres.CIEL||0, filieres.MELEC||0, filieres.Chaudronnerie||0 ],
            backgroundColor: ['#87CEEB', '#32CD32', '#A9A9A9']
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'R√©partition de tes r√©ponses par fili√®re' } }
        }
      });

      document.getElementById("restart").addEventListener("click", ()=> location.reload());
      res.scrollIntoView({behavior:'smooth'});
    });
  </script>
</body>
</html>
