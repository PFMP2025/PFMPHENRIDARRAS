<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test PFMP MTNE</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 2rem; color: #333; }
    h1, h2 { text-align: center; }
    form { max-width: 800px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .question { margin-bottom: 1.5rem; }
    label { display: block; margin: 0.4rem 0; }
    button { display: block; margin: 2rem auto; padding: 0.8rem 2rem; background: #004080; color: white; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; }
    #resultat { max-width: 600px; margin: 2rem auto; background: #e0ffe0; padding: 1.5rem; border-radius: 10px; color: #004d00; font-weight: bold; display: none; }
    .bouton-retour {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 8px 16px;
      font-size: 16px;
      border-radius: 5px;
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <button class="bouton-retour" onclick="history.back()">‚Üê Retour</button>
  <h1> Quelle PFMP sont faits pour toi ?</h1>
  <form id="qcmForm"></form>
  <div id="resultat"></div>
  <canvas id="graphiqueFiliere" style="max-width: 500px; margin: 2rem auto; display: none;"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const metiers = {
      ciel_devweb: { nom: "D√©veloppeur web", filiere: "CIEL" },
      ciel_embarque: { nom: "D√©veloppeur embarqu√©", filiere: "CIEL" },
      ciel_cyber: { nom: "Technicien cybers√©curit√©", filiere: "CIEL" },
      ciel_electronique: { nom: "Technicien √©lectronique", filiere: "CIEL" },
      melec_electricien: { nom: "√âlectricien du b√¢timent", filiere: "MELEC" },
      melec_maintenance: { nom: "Technicien de maintenance", filiere: "MELEC" }
    };

    const questions = [
      { q: "1. Tu es le plus satisfait quand tu :", options: [
        { t: "R√©sous un probl√®me complexe en trouvant une solution logique", m: ["ciel_cyber", "ciel_devweb", "melec_maintenance"] },
        { t: "Vois le r√©sultat concret de ce que tu as fabriqu√© ou install√©", m: ["melec_electricien"] }
      ]},
      { q: "2. Tu te sens plus √† l‚Äôaise quand :", options: [
        { t: "Tu peux imaginer ou cr√©er quelque chose de nouveau", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Tu respectes un plan, une norme ou une consigne", m: ["melec_electricien"] },
        { t: "Tu interviens en autonomie sur un syst√®me concret", m: ["melec_maintenance"] }
      ]},
      { q: "3. Face √† une difficult√© technique, tu pr√©f√®res :", options: [
        { t: "Analyser calmement la situation pour trouver une cause logique", m: ["ciel_cyber", "melec_maintenance"] },
        { t: "Essayer directement des solutions concr√®tes", m: ["melec_electricien"] }
      ]},
      { q: "4. Tu aimes particuli√®rement :", options: [
        { t: "Programmer ou comprendre des circuits √©lectroniques", m: ["ciel_embarque", "ciel_electronique"] },
        { t: "Travailler sur des c√¢bles, moteurs ou installations", m: ["melec_electricien", "melec_maintenance"] }
      ]},
      { q: "5. Ton environnement id√©al serait :", options: [
        { t: "Un endroit calme avec ordinateurs et logiciels", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Un atelier ou un chantier avec des outils techniques", m: ["melec_electricien"] }
      ]},
      { q: "6. Quel type de t√¢che pr√©f√®res-tu ?", options: [
        { t: "Coder, tester et am√©liorer un programme", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "C√¢bler et brancher des composants sur un chantier", m: ["melec_electricien"] },
        { t: "Chercher et corriger des pannes dans un syst√®me", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "7. Ce qui te motive le plus dans un projet, c‚Äôest :", options: [
        { t: "Comprendre le fonctionnement global", m: ["ciel_cyber", "ciel_embarque"] },
        { t: "R√©aliser proprement une installation √©lectrique", m: ["melec_electricien"] },
        { t: "Assurer que tout fonctionne bien apr√®s mon passage", m: ["melec_maintenance"] }
      ]},
      { q: "8. Tu pr√©f√®res apprendre :", options: [
        { t: "En bidouillant toi-m√™me", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "En observant un professionnel faire", m: ["melec_electricien"] },
        { t: "En suivant des tutoriels clairs et logiques", m: ["ciel_cyber", "melec_maintenance"] }
      ]},
      { q: "9. Tu es plut√¥t :", options: [
        { t: "Cr√©atif et curieux", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Rigoureux et patient", m: ["melec_maintenance", "ciel_cyber"] },
        { t: "Pr√©cis et manuel", m: ["melec_electricien"] }
      ]},
      { q: "10. Dans un travail d‚Äô√©quipe, tu pr√©f√®res :", options: [
        { t: "Coder une partie technique", m: ["ciel_devweb"] },
        { t: "R√©aliser des branchements √† plusieurs", m: ["melec_electricien"] },
        { t: "Chercher des solutions ensemble √† un probl√®me", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "11. Tu aimerais qu'on te dise :", options: [
        { t: "Tu ma√Ætrises vraiment bien les logiciels !", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Ton c√¢blage est propre et conforme", m: ["melec_electricien"] },
        { t: "Gr√¢ce √† toi, √ßa remarche !", m: ["melec_maintenance"] }
      ]},
      { q: "12. Quand tu entends 'objet connect√©', tu penses :", options: [
        { t: "√Ä un projet domotique que je pourrais d√©velopper", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "√Ä une installation √©lectrique pilot√©e √† distance", m: ["melec_electricien"] },
        { t: "√Ä un appareil qu‚Äôil faudra d√©panner s‚Äôil tombe en panne", m: ["melec_maintenance"] }
      ]},
      { q: "13. Ce que tu pr√©f√®res dans les TP :", options: [
        { t: "Cr√©er un syst√®me ou un programme de z√©ro", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Mettre en service une installation compl√®te", m: ["melec_electricien"] },
        { t: "Trouver et r√©soudre des d√©fauts de fonctionnement", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "14. Tu pr√©f√®res quand :", options: [
        { t: "Il faut r√©fl√©chir √† une solution technique originale", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Il faut suivre une proc√©dure et tout tester", m: ["melec_maintenance"] },
        { t: "Il faut respecter les normes et les plans", m: ["melec_electricien"] }
      ]},
      { q: "15. Ton outil pr√©f√©r√© serait :", options: [
        { t: "Un ordinateur avec un √©diteur de code", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Un multim√®tre ou un tournevis", m: ["melec_maintenance", "melec_electricien"] },
        { t: "Un microcontr√¥leur ou des capteurs", m: ["ciel_embarque"] }
      ]},
      { q: "16. Tu pr√©f√®res travailler dans :", options: [
        { t: "Une salle informatique ou un bureau calme", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Un atelier ou une salle technique", m: ["ciel_embarque", "melec_maintenance"] },
        { t: "Un chantier ou un b√¢timent en construction", m: ["melec_electricien"] }
      ]},
      { q: "17. Ce qui t‚Äôamuse le plus :", options: [
        { t: "Programmer des petits jeux ou outils", m: ["ciel_devweb"] },
        { t: "Brancher et allumer des LED, tester des circuits", m: ["ciel_embarque"] },
        { t: "D√©monter un objet et le r√©parer", m: ["melec_maintenance"] }
      ]},
      { q: "18. Tu es fier quand :", options: [
        { t: "Ton code fonctionne du premier coup", m: ["ciel_devweb"] },
        { t: "Ton montage est bien r√©alis√©", m: ["melec_electricien"] },
        { t: "Tu d√©pannes un probl√®me complexe", m: ["ciel_cyber", "melec_maintenance"] }
      ]},
      { q: "19. En stage, tu aimerais :", options: [
        { t: "Cr√©er une application ou un syst√®me connect√©", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "Aider √† une installation √©lectrique", m: ["melec_electricien"] },
        { t: "Participer √† la maintenance de syst√®mes", m: ["melec_maintenance"] }
      ]},
      { q: "20. Ce que tu pr√©f√®res dans un plan ou sch√©ma :", options: [
        { t: "L‚Äôadapter pour qu‚Äôil soit plus efficace", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Le suivre √† la lettre pour un montage r√©ussi", m: ["melec_electricien"] },
        { t: "Le comprendre pour d√©tecter des erreurs", m: ["melec_maintenance"] }
      ]},
      { q: "21. Quel compliment te ferait le plus plaisir ?", options: [
        { t: "Tu as des id√©es de g√©nie", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Ton travail est net et pr√©cis", m: ["melec_electricien"] },
        { t: "Tu trouves toujours la panne", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "22. Quand tu travailles, tu pr√©f√®res :", options: [
        { t: "Coder seul et en silence", m: ["ciel_devweb"] },
        { t: "Installer avec d'autres sur le terrain", m: ["melec_electricien"] },
        { t: "R√©fl√©chir en groupe √† une solution technique", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "23. Dans une journ√©e de travail id√©ale :", options: [
        { t: "Je cr√©e ou programme un objet", m: ["ciel_embarque"] },
        { t: "Je monte ou installe une structure", m: ["melec_electricien"] },
        { t: "Je r√©pare ou optimise un syst√®me", m: ["melec_maintenance"] }
      ]},
      { q: "24. Tu te sens utile quand :", options: [
        { t: "Je rends une machine ou un syst√®me plus s√©curis√©", m: ["ciel_cyber", "melec_maintenance"] },
        { t: "Je rends service √† un client en r√©parant", m: ["melec_maintenance", "melec_electricien"] },
        { t: "Je fais gagner du temps gr√¢ce √† mon logiciel", m: ["ciel_devweb"] }
      ]},
      { q: "25. Tu serais pr√™t √† :", options: [
        { t: "Cr√©er un programme de domotique √† la maison", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "Installer des prises et des interrupteurs chez quelqu‚Äôun", m: ["melec_electricien"] },
        { t: "Diagnostiquer un tableau √©lectrique", m: ["melec_maintenance"] }
      ]},
      { q: "26. Ton avenir professionnel id√©al serait :", options: [
        { t: "Dans une entreprise de d√©veloppement logiciel", m: ["ciel_devweb"] },
        { t: "Sur les chantiers ou dans l‚Äôinstallation technique", m: ["melec_electricien"] },
        { t: "Dans une √©quipe de maintenance industrielle", m: ["melec_maintenance"] }
      ]},
      { q: "27. Tu pr√©f√®res travailler avec :", options: [
        { t: "Des logiciels et interfaces num√©riques", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Des outils √©lectriques et des c√¢bles", m: ["melec_electricien"] },
        { t: "Des syst√®mes m√©caniques et automatiques", m: ["melec_maintenance"] }
      ]},
      { q: "28. Une situation id√©ale de travail serait :", options: [
        { t: "Cr√©er une appli de gestion connect√©e", m: ["ciel_devweb"] },
        { t: "Monter un coffret √©lectrique complet", m: ["melec_electricien"] },
        { t: "Diagnostiquer une panne sur une machine", m: ["melec_maintenance"] }
      ]},
      { q: "29. Ce que tu aimerais approfondir en formation :", options: [
        { t: "Les langages informatiques (HTML, Python...)", m: ["ciel_devweb"] },
        { t: "Le c√¢blage et la norme NFC 15-100", m: ["melec_electricien"] },
        { t: "Les automatismes et la s√©curit√©", m: ["melec_maintenance"] }
      ]},
      { q: "30. Tu pr√©f√®res un m√©tier qui :", options: [
        { t: "√âvolue avec le num√©rique et les logiciels", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Est utile sur les chantiers et dans les b√¢timents", m: ["melec_electricien"] },
        { t: "Garanti le bon fonctionnement d‚Äôinstallations techniques", m: ["melec_maintenance"] }
      ]}
    ];

    const form = document.getElementById("qcmForm");
    questions.forEach((q, i) => {
      const block = document.createElement("div");
      block.className = "question";
      const title = document.createElement("h2");
      title.textContent = q.q;
      block.appendChild(title);
      q.options.forEach((opt) => {
        const label = document.createElement("label");
        label.innerHTML = `<input type=\"radio\" name=\"q${i}\" value=\"${opt.m.join(',')}\"> ${opt.t}`;
        block.appendChild(label);
      });
      form.appendChild(block);
    });

    const submit = document.createElement("button");
    submit.type = "submit";
    submit.textContent = "Voir mes r√©sultats";
    form.appendChild(submit);

    form.addEventListener("submit", function(e) {
      e.preventDefault();
      const scores = {}, filieres = {};
      for (let key in metiers) {
        scores[key] = 0;
        filieres[metiers[key].filiere] = 0;
      }

      questions.forEach((_, i) => {
        const answer = document.querySelector(`input[name="q${i}"]:checked`);
        if (answer) {
          answer.value.split(',').forEach(m => {
            scores[m]++;
            filieres[metiers[m].filiere]++;
          });
        }
      });

      const totalMetierPoints = Object.values(scores).reduce((a, b) => a + b, 0);
      const topMetiers = Object.entries(scores)
        .map(([key, val]) => ({ nom: metiers[key].nom, score: Math.round((val / totalMetierPoints) * 100) }))
        .filter(r => r.score > 0)
        .sort((a, b) => b.score - a.score)
        .slice(0, 3);

      const topFiliere = Object.entries(filieres).sort((a, b) => b[1] - a[1])[0][0];

      const div = document.getElementById("resultat");
      div.innerHTML = `
        <h2>üîé R√©sultats</h2>
        <p><strong>Fili√®re dominante : ${topFiliere}</strong></p>
        <ul>
          ${topMetiers.map(r => `<li>${r.nom} : ${r.score} %</li>`).join('')}
        </ul>
        <div id="suggestionsStages"><em>Chargement des suggestions de stage...</em></div>
        <div style="margin-top:1.5rem; text-align:center;">
          <button onclick="location.reload()" style="margin:0.5rem;padding:0.5rem 1rem;background:#ccc;border:none;border-radius:4px;">üîÅ Recommencer</button>
        </div>
      `;

      const canvas = document.getElementById("graphiqueFiliere");
      canvas.style.display = "block";

      const ctx = canvas.getContext("2d");
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['CIEL', 'MELEC'],
          datasets: [{
            label: 'R√©partition par fili√®re',
            data: [
              filieres.CIEL || 0,
              filieres.MELEC || 0
            ],
            backgroundColor: [
              '#87CEEB',
              '#32CD32'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' },
            title: {
              display: true,
              text: 'R√©partition de tes r√©ponses par fili√®re'
            }
          }
        }
      });

      // R√©cup√©ration dynamique des lieux depuis fiches.html
      fetch('fiches.html')
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const listItems = doc.querySelectorAll(`#${topFiliere.toLowerCase()} ul li`);
          const lieux = Array.from(listItems).map(li => li.textContent.trim());
          const suggestions = lieux.sort(() => 0.5 - Math.random()).slice(0, 5);

          const suggestionsHtml = `
            <h3>üè≠ Suggestions de lieux de stage (${topFiliere}) :</h3>
            <ul>
              ${suggestions.map(lieu => `<li>${lieu}</li>`).join('')}
            </ul>
          `;
          document.getElementById("suggestionsStages").innerHTML = suggestionsHtml;
        })
        .catch(err => {
          console.error('Erreur chargement lieux :', err);
          document.getElementById("suggestionsStages").innerHTML = `<p style="color:red;">Impossible de charger les suggestions depuis fiches.html</p>`;
        });

      div.style.display = "block";
      form.style.display = "none";
      div.scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
