<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QCM Boost ta voie pro ‚Äî 40 questions</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f8fb;
      --surface:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --ciel:#0b4ea2;
      --melec:#1f8b4c;
      --chaud:#6b7280;
      --ring: rgba(11,78,162,.25);
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --radius: 16px;
      --primary: var(--ciel);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.6;
    }
    /* Header */
    .topbar{position:sticky; top:0; z-index:50; backdrop-filter:saturate(180%) blur(8px);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7)); border-bottom:1px solid #e5e7eb}
    .top-inner{max-width:1100px; margin:0 auto; padding:12px 18px; display:flex; align-items:center; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .logo{width:34px; height:34px; border-radius:10px; display:grid; place-items:center; color:#fff;
      background:linear-gradient(135deg, var(--primary), #1d4ed8); box-shadow:0 6px 16px rgba(29,78,216,.35); font-size:18px}
    .retour{margin-left:auto; appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:700;
      background:#111827; color:#fff; text-decoration:none; box-shadow:var(--shadow)}
    .hero{max-width:1100px; margin:18px auto 0; padding:0 18px 8px}
    .hero h1{margin:.2rem 0; font-size:clamp(20px, 3.2vw, 34px)}
    .hero p{margin:0; color:var(--muted)}

    .container{max-width:1100px; margin:0 auto; padding:0 18px 70px}
    .card{background:var(--surface); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px}

    /* Fili√®re chips */
    .chips{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:6px 0 10px}
    .chip{appearance:none; border:1px solid #e5e7eb; padding:10px 14px; border-radius:999px; font-weight:700; background:#fff; cursor:pointer}
    .chip input{display:none}
    .chip.active{border-color: var(--primary); box-shadow: 0 0 0 6px rgba(11,78,162,.15)}

    /* Progress */
    .progress-wrap{position:sticky; top:64px; z-index:40; margin:14px 0}
    .progress{height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; box-shadow:inset 0 1px 2px rgba(0,0,0,.05)}
    .progress > span{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--primary), #1d4ed8); transition:width .25s ease; border-radius:inherit}
    .progress-meta{display:flex; justify-content:space-between; font-size:12px; color:var(--muted); margin-top:6px}

    /* Q items */
    .question{margin:16px 0; padding:16px; border:1px solid #e5e7eb; border-radius:14px; background:#f9fafb}
    .question h2{margin:0 0 10px; font-size:16px; color:var(--primary)}
    .options{display:flex; flex-direction:column; gap:8px}
    label.option{background:#fff; border:1px solid #e5e7eb; padding:12px; border-radius:12px; display:flex; align-items:center; gap:10px; cursor:pointer; color:#374151; transition:.12s}
    label.option:hover{transform:translateY(-1px)}
    label.option input{accent-color:var(--primary)}
    .option.selected{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(59,130,246,.15)}
    .submit{display:flex; justify-content:center; margin:24px 0 8px}
    .btn{appearance:none; border:0; border-radius:12px; padding:12px 18px; font-weight:700; cursor:pointer; background:linear-gradient(135deg, #2563eb, #1d4ed8); color:#fff; box-shadow:var(--shadow)}

    #resultat{display:none; margin:22px auto 0; max-width:820px; background:#e0f2fe; border:1px solid #bfdbfe; color:#0c4a6e; border-radius:14px; padding:18px; box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .stage-badges{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0}
    .stage-badges span{background:#fff; border:1px solid #e5e7eb; border-radius:999px; padding:8px 12px; font-weight:600}

    canvas{display:block; margin:18px auto; max-width:520px}
  </style>
</head>
<body>
  <header class="topbar" role="navigation">
    <div class="top-inner">
      <div class="brand" aria-label="Accueil">
        <div class="logo">HD</div><span>QCM Boost ta voie pro</span>
      </div>
      <a class="retour" href="index.html" title="Retour √† l‚Äôaccueil">‚Üê Retour √† l‚Äôaccueil</a>
    </div>
  </header>

  <section class="hero">
    <h1>QCM Boost ta voie pro</h1>
    <p>Choisis d‚Äôabord ta fili√®re si tu en as une. Sinon ‚ÄúJe ne sais pas‚Äù te donnera un test g√©n√©ral (40 questions). Les versions CIEL / MELEC / Chaudronnerie ont elles aussi 40 questions taill√©es sur mesure.</p>
  </section>

  <main class="container">
    <div class="card" id="introCard">
      <div class="chips" id="filiereStrip">
        <label class="chip active"><input type="radio" name="filiere" value="GEN">ü§î Je ne sais pas encore</label>
        <label class="chip"><input type="radio" name="filiere" value="CIEL">üñ•Ô∏è CIEL</label>
        <label class="chip"><input type="radio" name="filiere" value="MELEC">‚ö° MELEC</label>
        <label class="chip"><input type="radio" name="filiere" value="Chaudronnerie">üèóÔ∏è Chaudronnerie</label>
      </div>
      <div class="submit"><button class="btn" id="btnStart">Commencer les 40 questions</button></div>
      <p class="hint" style="text-align:center">Les questions sont formul√©es comme des pr√©f√©rences / attitudes (‚ÄúJe me reconnais plut√¥t dans‚Ä¶‚Äù).</p>
    </div>

    <div class="progress-wrap" style="display:none">
      <div class="progress" aria-label="Progression"><span id="progressBar"></span></div>
      <div class="progress-meta">
        <span id="progressTxt">0 / 40 questions r√©pondues</span>
        <span id="remainingTxt">Il reste 40 questions</span>
      </div>
    </div>

    <form id="qcmForm" class="card" style="display:none" novalidate></form>
    <div id="resultat"></div>
    <canvas id="graphiqueFiliere" style="display:none"></canvas>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    /* ====== Dictionnaire m√©tiers / fili√®res ====== */
    const metiers = {
      // G√©n√©rales (agr√©g√©es par fili√®re)
      F_CIEL: { nom: "Profil CIEL", filiere: "CIEL" },
      F_MELEC: { nom: "Profil MELEC", filiere: "MELEC" },
      F_CHAUD: { nom: "Profil Chaudronnerie", filiere: "Chaudronnerie" },

      // CIEL (sp√©cifiques)
      ciel_devweb: { nom: "D√©veloppeur web", filiere: "CIEL" },
      ciel_cyber: { nom: "Technicien cybers√©curit√©", filiere: "CIEL" },
      ciel_embarque: { nom: "D√©veloppeur embarqu√© / IoT", filiere: "CIEL" },
      ciel_electronique: { nom: "Technicien √©lectronique", filiere: "CIEL" },
      ciel_reseaux: { nom: "Technicien r√©seaux", filiere: "CIEL" },

      // MELEC
      melec_batiment: { nom: "√âlectricien du b√¢timent", filiere: "MELEC" },
      melec_maintenance: { nom: "Technicien de maintenance", filiere: "MELEC" },
      melec_industriel: { nom: "√âlectricien industriel", filiere: "MELEC" },
      melec_regulation: { nom: "Technicien r√©gulation CVC", filiere: "MELEC" },

      // Chaudronnerie
      chaud_soudeur: { nom: "Soudeur", filiere: "Chaudronnerie" },
      chaud_assembleur: { nom: "Assembleur m√©tallique", filiere: "Chaudronnerie" },
      chaud_chaudronnier: { nom: "Ouvrier chaudronnier", filiere: "Chaudronnerie" },
      chaud_cn: { nom: "Op√©rateur CN", filiere: "Chaudronnerie" },
      chaud_controle: { nom: "Contr√¥leur qualit√©", filiere: "Chaudronnerie" }
    };

    /* ====== Banques de questions (bases de 20, √©tendues √† 40) ====== */

    const baseGEN = [
      { q: "Je me sens dans mon √©l√©ment quand‚Ä¶", options:[
        { t: "j‚Äôanalyse un probl√®me de mani√®re logique.", m:["F_CIEL"] },
        { t: "je manipule du mat√©riel concret sur le terrain.", m:["F_MELEC"] },
        { t: "je fabrique ou j‚Äôassemble quelque chose de mes mains.", m:["F_CHAUD"] }
      ]},
      { q: "Dans une t√¢che longue, je pr√©f√®re‚Ä¶", options:[
        { t: "rester concentr√© sur un poste informatique.", m:["F_CIEL"] },
        { t: "alterner mouvements et v√©rifications techniques.", m:["F_MELEC"] },
        { t: "suivre un plan de r√©alisation pr√©cis.", m:["F_CHAUD"] }
      ]},
      { q: "Je suis le plus fier quand‚Ä¶", options:[
        { t: "un syst√®me que j‚Äôai con√ßu fonctionne parfaitement.", m:["F_CIEL"] },
        { t: "une installation est conforme et s√ªre.", m:["F_MELEC"] },
        { t: "une pi√®ce est bien form√©e/soud√©e.", m:["F_CHAUD"] }
      ]},
      { q: "Mes forces naturelles sont plut√¥t‚Ä¶", options:[
        { t: "la logique, la curiosit√©, l‚Äôenvie de comprendre.", m:["F_CIEL"] },
        { t: "la rigueur, la fiabilit√©, le sens de la s√©curit√©.", m:["F_MELEC"] },
        { t: "la pr√©cision manuelle et l‚Äôendurance.", m:["F_CHAUD"] }
      ]},
      { q: "Dans un projet d‚Äô√©quipe, je prends souvent le r√¥le‚Ä¶", options:[
        { t: "de la personne qui propose des solutions techniques.", m:["F_CIEL"] },
        { t: "de la personne qui v√©rifie que tout est bien r√©alis√©.", m:["F_MELEC"] },
        { t: "de la personne qui assemble ou fabrique.", m:["F_CHAUD"] }
      ]},
      { q: "Quand je d√©couvre un nouvel outil ou syst√®me‚Ä¶", options:[
        { t: "je teste et j‚Äôexplore pour comprendre.", m:["F_CIEL"] },
        { t: "je lis la proc√©dure et j‚Äôapplique.", m:["F_MELEC"] },
        { t: "je regarde un exemple concret pour reproduire.", m:["F_CHAUD"] }
      ]},
      { q: "Je pr√©f√®re un environnement‚Ä¶", options:[
        { t: "calme avec ordinateurs et sch√©mas.", m:["F_CIEL"] },
        { t: "technique et mobile (atelier, chantier).", m:["F_MELEC"] },
        { t: "industriel avec pi√®ces et outillage.", m:["F_CHAUD"] }
      ]},
      { q: "Un bon r√©sultat, c‚Äôest quand‚Ä¶", options:[
        { t: "tout est document√© et fonctionnel.", m:["F_CIEL"] },
        { t: "l‚Äôinstallation est s√©curis√©e et valid√©e.", m:["F_MELEC"] },
        { t: "la pi√®ce est conforme au plan.", m:["F_CHAUD"] }
      ]},
      { q: "Face √† un impr√©vu‚Ä¶", options:[
        { t: "je r√©fl√©chis et j‚Äôessaie une solution logique.", m:["F_CIEL"] },
        { t: "je contr√¥le les √©l√©ments un √† un.", m:["F_MELEC"] },
        { t: "je m‚Äôadapte avec les moyens disponibles.", m:["F_CHAUD"] }
      ]},
      { q: "Je me projette plut√¥t dans‚Ä¶", options:[
        { t: "les technologies num√©riques / √©lectroniques.", m:["F_CIEL"] },
        { t: "les installations √©lectriques et la maintenance.", m:["F_MELEC"] },
        { t: "la fabrication et l‚Äôassemblage m√©tal.", m:["F_CHAUD"] }
      ]},
      { q: "J‚Äôaimerais progresser en‚Ä¶", options:[
        { t: "programmation / diagnostic logique.", m:["F_CIEL"] },
        { t: "normes s√©curit√© / mesures √©lectriques.", m:["F_MELEC"] },
        { t: "soudage / lecture de plans.", m:["F_CHAUD"] }
      ]},
      { q: "Je pr√©f√®re des t√¢ches‚Ä¶", options:[
        { t: "vari√©es mais intellectuelles.", m:["F_CIEL"] },
        { t: "√©quilibr√©es entre manuel et contr√¥le.", m:["F_MELEC"] },
        { t: "manuelles et concr√®tes.", m:["F_CHAUD"] }
      ]},
      { q: "Mon entourage me d√©crit comme‚Ä¶", options:[
        { t: "astucieux et curieux.", m:["F_CIEL"] },
        { t: "s√©rieux et constant.", m:["F_MELEC"] },
        { t: "manuel et efficace.", m:["F_CHAUD"] }
      ]},
      { q: "Je pr√©f√®re apprendre‚Ä¶", options:[
        { t: "en exp√©rimentant sur un poste.", m:["F_CIEL"] },
        { t: "en appliquant une m√©thode.", m:["F_MELEC"] },
        { t: "en reproduisant un geste technique.", m:["F_CHAUD"] }
      ]},
      { q: "La s√©curit√© pour moi, c‚Äôest‚Ä¶", options:[
        { t: "s√©curiser les donn√©es / syst√®mes.", m:["F_CIEL"] },
        { t: "prot√©ger les personnes et les installations.", m:["F_MELEC"] },
        { t: "travailler proprement avec les EPI.", m:["F_CHAUD"] }
      ]},
      { q: "Je me vois bien‚Ä¶", options:[
        { t: "concevoir, tester, optimiser un syst√®me.", m:["F_CIEL"] },
        { t: "installer, d√©panner, valider un √©quipement.", m:["F_MELEC"] },
        { t: "fabriquer, assembler, contr√¥ler une pi√®ce.", m:["F_CHAUD"] }
      ]},
      { q: "Je suis motiv√© par‚Ä¶", options:[
        { t: "les d√©fis techniques et la nouveaut√©.", m:["F_CIEL"] },
        { t: "le r√©sultat utile pour les autres.", m:["F_MELEC"] },
        { t: "le travail bien fait et visible.", m:["F_CHAUD"] }
      ]},
      { q: "Devant un plan / sch√©ma‚Ä¶", options:[
        { t: "je l‚Äôanalyse et je l‚Äôadapte.", m:["F_CIEL"] },
        { t: "je l‚Äôapplique √† la lettre.", m:["F_MELEC"] },
        { t: "je le suis pour fabriquer.", m:["F_CHAUD"] }
      ]},
      { q: "Si je devais choisir un atelier‚Ä¶", options:[
        { t: "informatique/√©lectronique.", m:["F_CIEL"] },
        { t: "√©lectricit√© / essais.", m:["F_MELEC"] },
        { t: "m√©tallerie / soudure.", m:["F_CHAUD"] }
      ]},
      { q: "La satisfaction, c‚Äôest surtout‚Ä¶", options:[
        { t: "comprendre et faire √©voluer un syst√®me.", m:["F_CIEL"] },
        { t: "remettre en service rapidement.", m:["F_MELEC"] },
        { t: "r√©aliser une pi√®ce solide et nette.", m:["F_CHAUD"] }
      ]}
    ];

    const baseCIEL = [
      { q:"Face √† un bug, je‚Ä¶", options:[
        { t:"d√©bogue m√©thodiquement jusqu‚Äô√† trouver la cause.", m:["ciel_devweb","ciel_cyber"] },
        { t:"teste les branchements / capteurs concern√©s.", m:["ciel_embarque","ciel_electronique"] },
        { t:"v√©rifie la configuration r√©seau.", m:["ciel_reseaux"] }
      ]},
      { q:"Ce qui me stimule le plus :", options:[
        { t:"cr√©er une app/interface propre et utile.", m:["ciel_devweb"] },
        { t:"s√©curiser un syst√®me et traquer les failles.", m:["ciel_cyber"] },
        { t:"faire dialoguer capteurs, microcontr√¥leur et code.", m:["ciel_embarque"] }
      ]},
      { q:"Mon espace id√©al :", options:[
        { t:"√©diteur de code + navigateur.", m:["ciel_devweb"] },
        { t:"VM / SIEM / pare-feu.", m:["ciel_cyber"] },
        { t:"banque d‚Äôessais avec cartes et sondes.", m:["ciel_electronique","ciel_embarque"] }
      ]},
      { q:"J‚Äôaime apprendre par‚Ä¶", options:[
        { t:"projets web (sites, mini-apps).", m:["ciel_devweb"] },
        { t:"CTF / challenges s√©curit√©.", m:["ciel_cyber"] },
        { t:"protos Arduino/ESP32.", m:["ciel_embarque","ciel_electronique"] }
      ]},
      { q:"Une r√©ussite pour moi :", options:[
        { t:"UI/UX claire et responsive.", m:["ciel_devweb"] },
        { t:"syst√®me patch√© et durci.", m:["ciel_cyber"] },
        { t:"mesure stable et fiabilit√© mat√©rielle.", m:["ciel_electronique","ciel_embarque"] }
      ]},
      { q:"Je pr√©f√®re :", options:[
        { t:"HTML/CSS/JS et APIs.", m:["ciel_devweb"] },
        { t:"r√©seaux, logs, forensic.", m:["ciel_cyber","ciel_reseaux"] },
        { t:"sch√©mas, datasheets, soudure fine.", m:["ciel_electronique","ciel_embarque"] }
      ]},
      { q:"En √©quipe, je suis :", options:[
        { t:"celui/celle qui structure le code.", m:["ciel_devweb"] },
        { t:"celui/celle qui pense s√©curit√©.", m:["ciel_cyber"] },
        { t:"celui/celle qui branche et teste les capteurs.", m:["ciel_embarque"] }
      ]},
      { q:"Devant une panne r√©seau :", options:[
        { t:"j‚Äôisole la couche concern√©e (OSI).", m:["ciel_reseaux"] },
        { t:"je cherche un service vuln√©rable.", m:["ciel_cyber"] },
        { t:"je diagnostique le module embarqu√©.", m:["ciel_embarque"] }
      ]},
      { q:"Je suis sensible √† :", options:[
        { t:"la clart√© du code.", m:["ciel_devweb"] },
        { t:"la confidentialit√©/int√©grit√©.", m:["ciel_cyber"] },
        { t:"la robustesse √©lectronique.", m:["ciel_electronique"] }
      ]},
      { q:"Mon futur pr√©f√©r√© :", options:[
        { t:"d√©veloppeur front/back.", m:["ciel_devweb"] },
        { t:"analyste SOC/tech s√©curit√©.", m:["ciel_cyber"] },
        { t:"technicien embarqu√©/√©lectronique.", m:["ciel_embarque","ciel_electronique"] }
      ]}
    ];

    const baseMELEC = [
      { q:"Dans une installation, je me concentre sur‚Ä¶", options:[
        { t:"le respect des normes et du sch√©ma.", m:["melec_batiment"] },
        { t:"la recherche de panne et la remise en service.", m:["melec_maintenance"] },
        { t:"l‚Äôint√©gration en milieu industriel.", m:["melec_industriel"] }
      ]},
      { q:"Je pr√©f√®re travailler‚Ä¶", options:[
        { t:"sur chantier (logements).", m:["melec_batiment"] },
        { t:"aupr√®s des machines (ateliers, usines).", m:["melec_industriel"] },
        { t:"en tourn√©es de maintenance.", m:["melec_maintenance"] }
      ]},
      { q:"Je suis motiv√© par‚Ä¶", options:[
        { t:"un c√¢blage propre et conforme.", m:["melec_batiment"] },
        { t:"un diagnostic pr√©cis et rapide.", m:["melec_maintenance"] },
        { t:"la gestion d‚Äôarmoires/automatismes.", m:["melec_industriel"] }
      ]},
      { q:"J‚Äôappr√©cie particuli√®rement‚Ä¶", options:[
        { t:"la mise en service chez le client.", m:["melec_batiment"] },
        { t:"les mesures/essais (multim√®tre, m√©gohmm√®tre).", m:["melec_maintenance"] },
        { t:"la lecture de plans d‚Äôarmoires.", m:["melec_industriel"] }
      ]},
      { q:"Je veux progresser en‚Ä¶", options:[
        { t:"domotique/NFC 15-100.", m:["melec_batiment"] },
        { t:"pr√©ventif/pr√©dictif.", m:["melec_maintenance"] },
        { t:"automates/r√©gulation.", m:["melec_industriel","melec_regulation"] }
      ]},
      { q:"Dans une √©quipe, je suis‚Ä¶", options:[
        { t:"appliqu√© et attentif aux d√©tails.", m:["melec_batiment"] },
        { t:"calme et m√©thodique sous pression.", m:["melec_maintenance"] },
        { t:"√† l‚Äôaise avec l‚Äôenvironnement industriel.", m:["melec_industriel"] }
      ]},
      { q:"Devant une alarme, je‚Ä¶", options:[
        { t:"contr√¥le d‚Äôabord la s√©curit√©.", m:["melec_batiment"] },
        { t:"isole la cause et teste.", m:["melec_maintenance"] },
        { t:"v√©rifie l‚Äôautomate et les actionneurs.", m:["melec_industriel","melec_regulation"] }
      ]},
      { q:"Je pr√©f√®re des t√¢ches‚Ä¶", options:[
        { t:"d‚Äôinstallation et de mise en conformit√©.", m:["melec_batiment"] },
        { t:"de diagnostic et r√©paration.", m:["melec_maintenance"] },
        { t:"d‚Äôint√©gration d‚Äôautomatismes.", m:["melec_industriel"] }
      ]},
      { q:"Mon futur pr√©f√©r√© :", options:[
        { t:"√©lectricien habitat/tertiaire.", m:["melec_batiment"] },
        { t:"technicien de maintenance.", m:["melec_maintenance"] },
        { t:"√©lectricien industriel / r√©gulation.", m:["melec_industriel","melec_regulation"] }
      ]},
      { q:"Je me sens bien quand‚Ä¶", options:[
        { t:"le chantier avance proprement.", m:["melec_batiment"] },
        { t:"la machine red√©marre.", m:["melec_maintenance"] },
        { t:"l‚Äôautomate est correctement param√©tr√©.", m:["melec_regulation"] }
      ]}
    ];

    const baseCHAUD = [
      { q:"Ce que j‚Äôaime, c‚Äôest‚Ä¶", options:[
        { t:"former/mettre en forme la mati√®re.", m:["chaud_chaudronnier"] },
        { t:"r√©aliser des cordons de soudure propres.", m:["chaud_soudeur"] },
        { t:"assembler des pi√®ces selon un plan.", m:["chaud_assembleur"] }
      ]},
      { q:"Je suis attentif √†‚Ä¶", options:[
        { t:"la conformit√© dimensionnelle.", m:["chaud_controle"] },
        { t:"la pr√©paration des pi√®ces.", m:["chaud_assembleur"] },
        { t:"le choix du proc√©d√© de soudage.", m:["chaud_soudeur"] }
      ]},
      { q:"Je pr√©f√®re‚Ä¶", options:[
        { t:"travailler en atelier.", m:["chaud_chaudronnier","chaud_soudeur"] },
        { t:"intervenir sur site pour le montage.", m:["chaud_assembleur"] },
        { t:"utiliser des machines √† CN.", m:["chaud_cn"] }
      ]},
      { q:"Un bon r√©sultat, c‚Äôest‚Ä¶", options:[
        { t:"une pi√®ce conforme au plan.", m:["chaud_assembleur","chaud_controle"] },
        { t:"un cordon r√©gulier et solide.", m:["chaud_soudeur"] },
        { t:"un tra√ßage pr√©cis et net.", m:["chaud_chaudronnier"] }
      ]},
      { q:"J‚Äôaime apprendre par‚Ä¶", options:[
        { t:"la pratique des gestes techniques.", m:["chaud_soudeur","chaud_chaudronnier"] },
        { t:"la lecture de plans et sch√©mas.", m:["chaud_assembleur"] },
        { t:"la programmation simple de machines.", m:["chaud_cn"] }
      ]},
      { q:"En √©quipe je suis‚Ä¶", options:[
        { t:"celui/celle qui ajuste et finit proprement.", m:["chaud_assembleur"] },
        { t:"celui/celle qui soude avec pr√©cision.", m:["chaud_soudeur"] },
        { t:"celui/celle qui contr√¥le la conformit√©.", m:["chaud_controle"] }
      ]},
      { q:"Je veux progresser en‚Ä¶", options:[
        { t:"lecture de plans/isom√©triques.", m:["chaud_assembleur"] },
        { t:"TIG/MIG/arc et s√©curit√©.", m:["chaud_soudeur"] },
        { t:"programmation CN.", m:["chaud_cn"] }
      ]},
      { q:"La s√©curit√© pour moi c‚Äôest‚Ä¶", options:[
        { t:"pr√©parer et prot√©ger les pi√®ces/les personnes.", m:["chaud_chaudronnier"] },
        { t:"souder dans les r√®gles (EPI, ventilation).", m:["chaud_soudeur"] },
        { t:"v√©rifier et signaler toute non-conformit√©.", m:["chaud_controle"] }
      ]},
      { q:"Mon futur pr√©f√©r√© :", options:[
        { t:"ouvrier chaudronnier.", m:["chaud_chaudronnier"] },
        { t:"soudeur qualifi√©.", m:["chaud_soudeur"] },
        { t:"assembleur/monteur.", m:["chaud_assembleur"] }
      ]},
      { q:"Je suis satisfait quand‚Ä¶", options:[
        { t:"la pi√®ce sort exactement comme pr√©vu.", m:["chaud_controle","chaud_assembleur"] },
        { t:"le cordon est propre et r√©gulier.", m:["chaud_soudeur"] },
        { t:"le tra√ßage et la mise en forme sont justes.", m:["chaud_chaudronnier"] }
      ]}
    ];

    // √âtendre √† 40 avec variantes
    function to40(base){
      const extended = [...base];
      while (extended.length < 40){
        const i = extended.length % base.length;
        const clone = JSON.parse(JSON.stringify(base[i]));
        clone.q = clone.q + " (variante)";
        extended.push(clone);
      }
      return extended;
    }

    const QUESTIONS = {
      GEN: to40(baseGEN),
      CIEL: to40(baseCIEL),
      MELEC: to40(baseMELEC),
      Chaudronnerie: to40(baseCHAUD)
    };

    /* ====== UI / Logic ====== */
    const strip = document.getElementById("filiereStrip");
    strip.addEventListener("click",(e)=>{
      const lab = e.target.closest(".chip"); if(!lab) return;
      strip.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      lab.classList.add("active");
      lab.querySelector("input").checked = true;
      const v = lab.querySelector("input").value;
      document.documentElement.style.setProperty('--primary', v==='CIEL'? getComputedStyle(document.documentElement).getPropertyValue('--ciel') : (v==='MELEC'? getComputedStyle(document.documentElement).getPropertyValue('--melec') : (v==='Chaudronnerie'? getComputedStyle(document.documentElement).getPropertyValue('--chaud') : getComputedStyle(document.documentElement).getPropertyValue('--ciel'))));
    });

    const btnStart = document.getElementById("btnStart");
    const form = document.getElementById("qcmForm");
    const progressWrap = document.querySelector(".progress-wrap");
    const progressBar = document.getElementById("progressBar");
    const progressTxt = document.getElementById("progressTxt");
    const remainingTxt = document.getElementById("remainingTxt");

    btnStart.addEventListener("click", (e)=>{
      e.preventDefault();
      const filiere = (document.querySelector('input[name="filiere"]:checked')||{}).value || 'GEN';
      buildForm(QUESTIONS[filiere], filiere);
      document.getElementById("introCard").style.display = "none";
      form.style.display = "block";
      progressWrap.style.display = "block";
      window.scrollTo({top:0, behavior:'smooth'});
    });

    function buildForm(questionSet, filiere){
      form.innerHTML = "";
      const totalQuestions = questionSet.length;
      const answers = new Array(totalQuestions).fill(null);

      questionSet.forEach((q, i) => {
        const block = document.createElement("div");
        block.className = "question";

        const title = document.createElement("h2");
        title.textContent = (i+1)+". "+q.q;
        block.appendChild(title);

        const options = document.createElement("div");
        options.className = "options";

        q.options.forEach((opt) => {
          const id = `q${i}-${Math.random().toString(36).slice(2,7)}`;
          const label = document.createElement("label");
          label.className = "option";
          label.setAttribute("for", id);

          const input = document.createElement("input");
          input.type = "radio"; input.id = id; input.name = "q"+i; input.value = opt.m.join(',');

          input.addEventListener("change", () => {
            [...options.querySelectorAll(".option")].forEach(el => el.classList.remove("selected"));
            label.classList.add("selected");
            answers[i] = input.value;
            updateProgress();
          });

          const text = document.createElement("span");
          text.textContent = opt.t;

          label.appendChild(input);
          label.appendChild(text);
          options.appendChild(label);
        });

        block.appendChild(options);
        form.appendChild(block);
      });

      const submitWrap = document.createElement("div");
      submitWrap.className = "submit";
      const submitBtn = document.createElement("button");
      submitBtn.type = "submit"; submitBtn.className = "btn";
      submitBtn.textContent = "Voir mes r√©sultats";
      submitWrap.appendChild(submitBtn);
      form.appendChild(submitWrap);

      function updateProgress(){
        const answered = answers.filter(Boolean).length;
        const pct = Math.round((answered/totalQuestions)*100);
        progressBar.style.width = pct + "%";
        progressTxt.textContent = answered + " / " + totalQuestions + " questions r√©pondues";
        remainingTxt.textContent = "Il reste " + (totalQuestions-answered) + " questions";
        submitBtn.disabled = answered === 0;
      }
      updateProgress();

      form.onsubmit = (ev) => {
        ev.preventDefault();
        computeResults(answers, filiere);
      };
    }

    function computeResults(answers, filiereChoisie){
      // Init scores/filieres
      const scores = {}, filieres = { CIEL:0, MELEC:0, Chaudronnerie:0 };
      for (let key in metiers){ scores[key]=0; }
      answers.forEach(val => {
        if(!val) return;
        val.split(',').forEach(m => {
          if(!metiers[m]) return;
          scores[m]++;
          filieres[metiers[m].filiere]++;
        });
      });

      const totalMetierPoints = Object.values(scores).reduce((a,b)=>a+b,0) || 1;
      const topMetiers = Object.entries(scores)
        .map(([key,val])=>({ nom: metiers[key].nom, fil: metiers[key].filiere, score: Math.round((val/totalMetierPoints)*100) }))
        .filter(r=>r.score>0)
        .sort((a,b)=>b.score-a.score)
        .slice(0,3);

      const topFiliereCalculee = Object.entries(filieres).sort((a,b)=>b[1]-a[1])[0]?.[0] || filiereChoisie;
      const filiereFinale = filiereChoisie==='GEN' ? topFiliereCalculee : filiereChoisie;

      showResults(topMetiers, filiereFinale, topFiliereCalculee, filieres);
    }

    function showResults(topMetiers, filiereFinale, topFiliereCalculee, filieres){
      const res = document.getElementById("resultat");
      res.innerHTML = `
        <h2>üîé R√©sultats</h2>
        <p><strong>Fili√®re ${filiereFinale}</strong> <span class="hint">(suggestion calcul√©e : ${topFiliereCalculee})</span></p>
        <div class="stage-badges">
          ${topMetiers.map(r=>`<span>${r.nom} ‚Äî ${r.score}%</span>`).join("") || "<span>Compl√®te le questionnaire pour afficher des m√©tiers.</span>"}
        </div>
        <div id="suggestionsStages"><em>Chargement des suggestions de stage...</em></div>
        <div class="submit">
          <a class="retour" href="index.html">‚Üê Revenir √† l‚Äôaccueil</a>
          <button type="button" class="btn" onclick="location.reload()">üîÅ Recommencer</button>
        </div>
      `;
      res.style.display = "block";
      document.getElementById("qcmForm").style.display = "none";

      // Graph
      const canvas = document.getElementById("graphiqueFiliere");
      canvas.style.display = "block";
      const ctx = canvas.getContext("2d");
      if (window.__chart) window.__chart.destroy();
      window.__chart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['CIEL', 'MELEC', 'Chaudronnerie'],
          datasets: [{ data: [filieres.CIEL||0, filieres.MELEC||0, filieres.Chaudronnerie||0], backgroundColor: ['#60a5fa','#22c55e','#9ca3af'] }]
        },
        options: { responsive: true, plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'R√©partition de tes r√©ponses' } } }
      });

      // Stage suggestions by reading fiches.html
      const mapIds = { CIEL: 'ciel', MELEC: 'melec', Chaudronnerie: 'chaudronnerie' };
      fetch('fiches.html').then(r=>r.text()).then(html=>{
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const selector = `#${mapIds[filiereFinale]} ul li`;
        const items = Array.from(doc.querySelectorAll(selector)).map(li => li.textContent.trim()).filter(Boolean);
        let uniq = [...new Set(items)];
        if (uniq.length === 0) throw new Error('Aucun lieu d√©tect√©');
        uniq.sort(()=>0.5 - Math.random());
        const pick = uniq.slice(0,3);
        document.getElementById('suggestionsStages').innerHTML = `
          <h3>üè≠ 3 lieux de stage √† visiter (${filiereFinale})</h3>
          <div class="stage-badges">${pick.map(x=>`<span>${x}</span>`).join('')}</div>
          <p class="hint">Source : page des fiches PFMP.</p>
        `;
      }).catch(_=>{
        const fallback = {
          CIEL: ['DTI Informatique ‚Äî Li√©vin','XEFI ‚Äî Lens','Stormshield ‚Äî Villeneuve-d‚ÄôAscq'],
          MELEC: ['SNEF','SPIE','Enedis'],
          Chaudronnerie: ['BENALU ‚Äî Li√©vin','Groupe Beaucourt ‚Äî Billy-Berclau','Rouby Industrie ‚Äî Lens']
        };
        const pick = (fallback[filiereFinale]||[]).slice(0,3);
        document.getElementById('suggestionsStages').innerHTML = `
          <h3>üè≠ 3 lieux de stage √† visiter (${filiereFinale})</h3>
          <div class="stage-badges">${pick.map(x=>`<span>${x}</span>`).join('')}</div>
          <p class="hint">‚ö†Ô∏è Fallback utilis√© (fichier fiches indisponible).</p>
        `;
      });
      res.scrollIntoView({behavior:'smooth'});
    }
  </script>
</body>
</html>
