<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test PFMP MTNE</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 2rem; color: #333; }
    h1, h2 { text-align: center; }
    form { max-width: 800px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .question { margin-bottom: 1.5rem; }
    label { display: block; margin: 0.4rem 0; }
    button { display: block; margin: 2rem auto; padding: 0.8rem 2rem; background: #004080; color: white; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; }
    #resultat { max-width: 600px; margin: 2rem auto; background: #e0ffe0; padding: 1.5rem; border-radius: 10px; color: #004d00; font-weight: bold; display: none; }
    .bouton-retour {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 8px 16px;
      font-size: 16px;
      border-radius: 5px;
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <button class="bouton-retour" onclick="history.back()">← Retour</button>
  <h1> Quelle PFMP sont faits pour toi ?</h1>
  <form id="qcmForm"></form>
  <div id="resultat"></div>
  <canvas id="graphiqueFiliere" style="max-width: 500px; margin: 2rem auto; display: none;"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const metiers = {
      ciel_devweb: { nom: "Développeur web", filiere: "CIEL" },
      ciel_embarque: { nom: "Développeur embarqué", filiere: "CIEL" },
      ciel_cyber: { nom: "Technicien cybersécurité", filiere: "CIEL" },
      ciel_electronique: { nom: "Technicien électronique", filiere: "CIEL" },
      melec_electricien: { nom: "Électricien du bâtiment", filiere: "MELEC" },
      melec_maintenance: { nom: "Technicien de maintenance", filiere: "MELEC" }
    };

    const questions = [
      { q: "1. Tu es le plus satisfait quand tu :", options: [
        { t: "Résous un problème complexe en trouvant une solution logique", m: ["ciel_cyber", "ciel_devweb", "melec_maintenance"] },
        { t: "Vois le résultat concret de ce que tu as fabriqué ou installé", m: ["melec_electricien"] }
      ]},
      { q: "2. Tu te sens plus à l’aise quand :", options: [
        { t: "Tu peux imaginer ou créer quelque chose de nouveau", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Tu respectes un plan, une norme ou une consigne", m: ["melec_electricien"] },
        { t: "Tu interviens en autonomie sur un système concret", m: ["melec_maintenance"] }
      ]},
      { q: "3. Face à une difficulté technique, tu préfères :", options: [
        { t: "Analyser calmement la situation pour trouver une cause logique", m: ["ciel_cyber", "melec_maintenance"] },
        { t: "Essayer directement des solutions concrètes", m: ["melec_electricien"] }
      ]},
      { q: "4. Tu aimes particulièrement :", options: [
        { t: "Programmer ou comprendre des circuits électroniques", m: ["ciel_embarque", "ciel_electronique"] },
        { t: "Travailler sur des câbles, moteurs ou installations", m: ["melec_electricien", "melec_maintenance"] }
      ]},
      { q: "5. Ton environnement idéal serait :", options: [
        { t: "Un endroit calme avec ordinateurs et logiciels", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Un atelier ou un chantier avec des outils techniques", m: ["melec_electricien"] }
      ]},
      { q: "6. Quel type de tâche préfères-tu ?", options: [
        { t: "Coder, tester et améliorer un programme", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Câbler et brancher des composants sur un chantier", m: ["melec_electricien"] },
        { t: "Chercher et corriger des pannes dans un système", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "7. Ce qui te motive le plus dans un projet, c’est :", options: [
        { t: "Comprendre le fonctionnement global", m: ["ciel_cyber", "ciel_embarque"] },
        { t: "Réaliser proprement une installation électrique", m: ["melec_electricien"] },
        { t: "Assurer que tout fonctionne bien après mon passage", m: ["melec_maintenance"] }
      ]},
      { q: "8. Tu préfères apprendre :", options: [
        { t: "En bidouillant toi-même", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "En observant un professionnel faire", m: ["melec_electricien"] },
        { t: "En suivant des tutoriels clairs et logiques", m: ["ciel_cyber", "melec_maintenance"] }
      ]},
      { q: "9. Tu es plutôt :", options: [
        { t: "Créatif et curieux", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Rigoureux et patient", m: ["melec_maintenance", "ciel_cyber"] },
        { t: "Précis et manuel", m: ["melec_electricien"] }
      ]},
      { q: "10. Dans un travail d’équipe, tu préfères :", options: [
        { t: "Coder une partie technique", m: ["ciel_devweb"] },
        { t: "Réaliser des branchements à plusieurs", m: ["melec_electricien"] },
        { t: "Chercher des solutions ensemble à un problème", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "11. Tu aimerais qu'on te dise :", options: [
        { t: "Tu maîtrises vraiment bien les logiciels !", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Ton câblage est propre et conforme", m: ["melec_electricien"] },
        { t: "Grâce à toi, ça remarche !", m: ["melec_maintenance"] }
      ]},
      { q: "12. Quand tu entends 'objet connecté', tu penses :", options: [
        { t: "À un projet domotique que je pourrais développer", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "À une installation électrique pilotée à distance", m: ["melec_electricien"] },
        { t: "À un appareil qu’il faudra dépanner s’il tombe en panne", m: ["melec_maintenance"] }
      ]},
      { q: "13. Ce que tu préfères dans les TP :", options: [
        { t: "Créer un système ou un programme de zéro", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Mettre en service une installation complète", m: ["melec_electricien"] },
        { t: "Trouver et résoudre des défauts de fonctionnement", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "14. Tu préfères quand :", options: [
        { t: "Il faut réfléchir à une solution technique originale", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Il faut suivre une procédure et tout tester", m: ["melec_maintenance"] },
        { t: "Il faut respecter les normes et les plans", m: ["melec_electricien"] }
      ]},
      { q: "15. Ton outil préféré serait :", options: [
        { t: "Un ordinateur avec un éditeur de code", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Un multimètre ou un tournevis", m: ["melec_maintenance", "melec_electricien"] },
        { t: "Un microcontrôleur ou des capteurs", m: ["ciel_embarque"] }
      ]},
      { q: "16. Tu préfères travailler dans :", options: [
        { t: "Une salle informatique ou un bureau calme", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Un atelier ou une salle technique", m: ["ciel_embarque", "melec_maintenance"] },
        { t: "Un chantier ou un bâtiment en construction", m: ["melec_electricien"] }
      ]},
      { q: "17. Ce qui t’amuse le plus :", options: [
        { t: "Programmer des petits jeux ou outils", m: ["ciel_devweb"] },
        { t: "Brancher et allumer des LED, tester des circuits", m: ["ciel_embarque"] },
        { t: "Démonter un objet et le réparer", m: ["melec_maintenance"] }
      ]},
      { q: "18. Tu es fier quand :", options: [
        { t: "Ton code fonctionne du premier coup", m: ["ciel_devweb"] },
        { t: "Ton montage est bien réalisé", m: ["melec_electricien"] },
        { t: "Tu dépannes un problème complexe", m: ["ciel_cyber", "melec_maintenance"] }
      ]},
      { q: "19. En stage, tu aimerais :", options: [
        { t: "Créer une application ou un système connecté", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "Aider à une installation électrique", m: ["melec_electricien"] },
        { t: "Participer à la maintenance de systèmes", m: ["melec_maintenance"] }
      ]},
      { q: "20. Ce que tu préfères dans un plan ou schéma :", options: [
        { t: "L’adapter pour qu’il soit plus efficace", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Le suivre à la lettre pour un montage réussi", m: ["melec_electricien"] },
        { t: "Le comprendre pour détecter des erreurs", m: ["melec_maintenance"] }
      ]},
      { q: "21. Quel compliment te ferait le plus plaisir ?", options: [
        { t: "Tu as des idées de génie", m: ["ciel_devweb", "ciel_embarque"] },
        { t: "Ton travail est net et précis", m: ["melec_electricien"] },
        { t: "Tu trouves toujours la panne", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "22. Quand tu travailles, tu préfères :", options: [
        { t: "Coder seul et en silence", m: ["ciel_devweb"] },
        { t: "Installer avec d'autres sur le terrain", m: ["melec_electricien"] },
        { t: "Réfléchir en groupe à une solution technique", m: ["melec_maintenance", "ciel_cyber"] }
      ]},
      { q: "23. Dans une journée de travail idéale :", options: [
        { t: "Je crée ou programme un objet", m: ["ciel_embarque"] },
        { t: "Je monte ou installe une structure", m: ["melec_electricien"] },
        { t: "Je répare ou optimise un système", m: ["melec_maintenance"] }
      ]},
      { q: "24. Tu te sens utile quand :", options: [
        { t: "Je rends une machine ou un système plus sécurisé", m: ["ciel_cyber", "melec_maintenance"] },
        { t: "Je rends service à un client en réparant", m: ["melec_maintenance", "melec_electricien"] },
        { t: "Je fais gagner du temps grâce à mon logiciel", m: ["ciel_devweb"] }
      ]},
      { q: "25. Tu serais prêt à :", options: [
        { t: "Créer un programme de domotique à la maison", m: ["ciel_embarque", "ciel_devweb"] },
        { t: "Installer des prises et des interrupteurs chez quelqu’un", m: ["melec_electricien"] },
        { t: "Diagnostiquer un tableau électrique", m: ["melec_maintenance"] }
      ]},
      { q: "26. Ton avenir professionnel idéal serait :", options: [
        { t: "Dans une entreprise de développement logiciel", m: ["ciel_devweb"] },
        { t: "Sur les chantiers ou dans l’installation technique", m: ["melec_electricien"] },
        { t: "Dans une équipe de maintenance industrielle", m: ["melec_maintenance"] }
      ]},
      { q: "27. Tu préfères travailler avec :", options: [
        { t: "Des logiciels et interfaces numériques", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Des outils électriques et des câbles", m: ["melec_electricien"] },
        { t: "Des systèmes mécaniques et automatiques", m: ["melec_maintenance"] }
      ]},
      { q: "28. Une situation idéale de travail serait :", options: [
        { t: "Créer une appli de gestion connectée", m: ["ciel_devweb"] },
        { t: "Monter un coffret électrique complet", m: ["melec_electricien"] },
        { t: "Diagnostiquer une panne sur une machine", m: ["melec_maintenance"] }
      ]},
      { q: "29. Ce que tu aimerais approfondir en formation :", options: [
        { t: "Les langages informatiques (HTML, Python...)", m: ["ciel_devweb"] },
        { t: "Le câblage et la norme NFC 15-100", m: ["melec_electricien"] },
        { t: "Les automatismes et la sécurité", m: ["melec_maintenance"] }
      ]},
      { q: "30. Tu préfères un métier qui :", options: [
        { t: "Évolue avec le numérique et les logiciels", m: ["ciel_devweb", "ciel_cyber"] },
        { t: "Est utile sur les chantiers et dans les bâtiments", m: ["melec_electricien"] },
        { t: "Garanti le bon fonctionnement d’installations techniques", m: ["melec_maintenance"] }
      ]}
    ];

    const form = document.getElementById("qcmForm");
    questions.forEach((q, i) => {
      const block = document.createElement("div");
      block.className = "question";
      const title = document.createElement("h2");
      title.textContent = q.q;
      block.appendChild(title);
      q.options.forEach((opt) => {
        const label = document.createElement("label");
        label.innerHTML = `<input type=\"radio\" name=\"q${i}\" value=\"${opt.m.join(',')}\"> ${opt.t}`;
        block.appendChild(label);
      });
      form.appendChild(block);
    });

    const submit = document.createElement("button");
    submit.type = "submit";
    submit.textContent = "Voir mes résultats";
    form.appendChild(submit);

    form.addEventListener("submit", function(e) {
      e.preventDefault();
      const scores = {}, filieres = {};
      for (let key in metiers) {
        scores[key] = 0;
        filieres[metiers[key].filiere] = 0;
      }

      questions.forEach((_, i) => {
        const answer = document.querySelector(`input[name="q${i}"]:checked`);
        if (answer) {
          answer.value.split(',').forEach(m => {
            scores[m]++;
            filieres[metiers[m].filiere]++;
          });
        }
      });

      const totalMetierPoints = Object.values(scores).reduce((a, b) => a + b, 0);
      const topMetiers = Object.entries(scores)
        .map(([key, val]) => ({ nom: metiers[key].nom, score: Math.round((val / totalMetierPoints) * 100) }))
        .filter(r => r.score > 0)
        .sort((a, b) => b.score - a.score)
        .slice(0, 3);

      const topFiliere = Object.entries(filieres).sort((a, b) => b[1] - a[1])[0][0];

      const div = document.getElementById("resultat");
      div.innerHTML = `
        <h2>🔎 Résultats</h2>
        <p><strong>Filière dominante : ${topFiliere}</strong></p>
        <ul>
          ${topMetiers.map(r => `<li>${r.nom} : ${r.score} %</li>`).join('')}
        </ul>
        <div id="suggestionsStages"><em>Chargement des suggestions de stage...</em></div>
        <div style="margin-top:1.5rem; text-align:center;">
          <button onclick="location.reload()" style="margin:0.5rem;padding:0.5rem 1rem;background:#ccc;border:none;border-radius:4px;">🔁 Recommencer</button>
        </div>
      `;

      const canvas = document.getElementById("graphiqueFiliere");
      canvas.style.display = "block";

      const ctx = canvas.getContext("2d");
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['CIEL', 'MELEC'],
          datasets: [{
            label: 'Répartition par filière',
            data: [
              filieres.CIEL || 0,
              filieres.MELEC || 0
            ],
            backgroundColor: [
              '#87CEEB',
              '#32CD32'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' },
            title: {
              display: true,
              text: 'Répartition de tes réponses par filière'
            }
          }
        }
      });

      // Récupération dynamique des lieux depuis fiches.html
      fetch('fiches.html')
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const listItems = doc.querySelectorAll(`#${topFiliere.toLowerCase()} ul li`);
          const lieux = Array.from(listItems).map(li => li.textContent.trim());
          const suggestions = lieux.sort(() => 0.5 - Math.random()).slice(0, 5);

          const suggestionsHtml = `
            <h3>🏭 Suggestions de lieux de stage (${topFiliere}) :</h3>
            <ul>
              ${suggestions.map(lieu => `<li>${lieu}</li>`).join('')}
            </ul>
          `;
          document.getElementById("suggestionsStages").innerHTML = suggestionsHtml;
        })
        .catch(err => {
          console.error('Erreur chargement lieux :', err);
          document.getElementById("suggestionsStages").innerHTML = `<p style="color:red;">Impossible de charger les suggestions depuis fiches.html</p>`;
        });

      div.style.display = "block";
      form.style.display = "none";
      div.scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
